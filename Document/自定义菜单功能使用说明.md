# 自定义菜单功能使用说明

## 概述

自定义菜单功能是"Send to AI"脚本的新增功能，允许用户通过Win+F3快捷键显示自定义菜单，选择不同的菜单项来执行不同的文本处理流程。

## 功能特点

1. **可配置菜单项**：通过Config.ini文件配置菜单项，支持任意数量的菜单项
2. **灵活的内容处理**：支持在内容中使用{text}变量，自动替换为剪贴板内容
3. **可配置执行流程**：每个菜单项可单独配置是否新建对话和是否发送回车
4. **多种触发方式**：支持鼠标点击和键盘数字键选择菜单项

## 使用方法

### 1. 基本使用流程

1. 复制要处理的文本
2. 按下Win+F3显示自定义菜单
3. 使用鼠标点击或键盘数字键选择菜单项
4. 脚本自动处理文本并发送到AI应用

### 2. 快捷键说明

- **Win+F1**：完整流程（包含Ctrl+K新建对话）
- **Win+F2**：简化流程（不包含Ctrl+K新建对话）
- **Win+F3**：显示自定义菜单
- **Win+F10**：重新加载配置文件

## 配置说明

### 1. 菜单配置结构

在Config.ini文件中添加以下配置：

```ini
[MenuSettings]
MenuCount=5

[MenuItem1]
Name=翻译成英文
Content=请将以下内容翻译成英文：\n\n{text}
NewChat=1
SendEnter=1

[MenuItem2]
Name=总结要点
Content=请总结以下内容的要点：\n\n{text}
NewChat=0
SendEnter=1
```

### 2. 配置项说明

- **MenuCount**：菜单项总数
- **Name**：菜单项显示名称
- **Content**：内容模板，支持{text}变量
- **NewChat**：是否新建对话（1=是，0=否）
- **SendEnter**：是否发送回车（1=是，0=否）

### 3. 内容模板变量

- **{text}**：自动替换为剪贴板中的文本内容
- **\n**：换行符

## 示例配置

### 示例1：翻译功能

```ini
[MenuItem1]
Name=翻译成英文
Content=请将以下内容翻译成英文：\n\n{text}
NewChat=1
SendEnter=1
```

### 示例2：代码解释

```ini
[MenuItem2]
Name=代码解释
Content=请解释以下代码的功能和原理：\n\n```text\n{text}\n```
NewChat=1
SendEnter=1
```

### 示例3：直接发送

```ini
[MenuItem3]
Name=直接发送
Content=
NewChat=1
SendEnter=1
```

## 执行流程

1. 用户选择菜单项
2. 脚本复制当前选中的文本到剪贴板
3. 根据Content配置处理文本（替换{text}变量）
4. 激活当前配置的AI应用
5. 根据NewChat配置决定是否执行Ctrl+K
6. 执行Ctrl+M进入输入模式
7. 粘贴处理后的文本
8. 根据SendEnter配置决定是否发送回车

## 注意事项

1. 确保Config.ini文件中包含正确的菜单配置
2. 菜单项编号必须从1开始，连续递增
3. 如果Content为空，将直接发送剪贴板内容
4. 使用Win+F10可以重新加载配置，无需重启脚本
5. 如果菜单配置有误，脚本会显示错误提示

## 故障排除

### 1. 菜单不显示

- 检查Config.ini文件是否存在MenuSettings节
- 确认MenuCount值大于0
- 使用Win+F10重新加载配置

### 2. 菜单项执行失败

- 检查MenuItem配置是否正确
- 确认菜单项编号连续且正确
- 查看脚本调试输出（如已启用）

### 3. 文本处理异常

- 检查Content配置中的{text}变量格式
- 确认剪贴板中有内容
- 尝试使用简单的Content配置测试

## 扩展建议

1. 可以添加更多菜单项，满足不同的文本处理需求
2. 可以结合AI应用的特点，设计专门的提示词模板
3. 可以定期更新菜单配置，优化AI交互效果